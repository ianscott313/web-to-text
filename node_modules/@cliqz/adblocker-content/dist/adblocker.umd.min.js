!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={})}(this,(function(e){"use strict";const t="cliqz-adblocker-script",s=new Set(["br","head","link","meta","script","style","s"]);function n(e){return 1===e.nodeType}function o(e){const t=new Set(["br","head","link","meta","script","style","s"]),s=new Set,n=new Set,o=new Set;for(const r of e)for(const e of[r,...r.querySelectorAll("[id]:not(html):not(body),[class]:not(html):not(body),[href]:not(html):not(body)")]){if(t.has(e.nodeName.toLowerCase()))continue;const r=e.id;r&&o.add(r);const i=e.classList;if(i)for(const e of i)s.add(e);const d=e.getAttribute("href");"string"==typeof d&&n.add(d)}return{classes:Array.from(s),hrefs:Array.from(n),ids:Array.from(o)}}function r(e){return`try{${e}}catch(c){}!function(){var c=document.currentScript,e=c&&c.parentNode;e&&e.removeChild(c)}();`}e.DOMMonitor=class{constructor(e){this.cb=e,this.knownIds=new Set,this.knownHrefs=new Set,this.knownClasses=new Set,this.observer=null}queryAll(e){this.cb({type:"elements",elements:[e.document.documentElement]}),this.handleUpdatedNodes([e.document.documentElement])}start(e){null===this.observer&&void 0!==e.MutationObserver&&(this.observer=new e.MutationObserver((e=>{this.handleUpdatedNodes(function(e){const s=[];for(const o of e)if("attributes"===o.type)n(o.target)&&s.push(o.target);else if("childList"===o.type)for(const e of o.addedNodes)n(e)&&e.id!==t&&s.push(e);return s}(e))})),this.observer.observe(e.document.documentElement,{attributes:!0,attributeFilter:["class","id","href"],childList:!0,subtree:!0}))}stop(){null!==this.observer&&(this.observer.disconnect(),this.observer=null)}handleNewFeatures({hrefs:e,ids:t,classes:s}){const n=[],o=[],r=[];for(const e of t)!1===this.knownIds.has(e)&&(n.push(e),this.knownIds.add(e));for(const e of s)!1===this.knownClasses.has(e)&&(o.push(e),this.knownClasses.add(e));for(const t of e)!1===this.knownHrefs.has(t)&&(r.push(t),this.knownHrefs.add(t));return(0!==n.length||0!==o.length||0!==r.length)&&(this.cb({type:"features",classes:o,hrefs:r,ids:n}),!0)}handleUpdatedNodes(e){return 0!==e.length&&(this.cb({type:"elements",elements:e.filter((e=>!1===s.has(e.nodeName.toLowerCase())))}),this.handleNewFeatures(o(e)))}},e.autoRemoveScript=r,e.extractFeaturesFromDOM=o,e.injectScript=function(e,s){const n=s.createElement("script");n.type="text/javascript",n.id=t,n.async=!1,n.appendChild(s.createTextNode(r(e)));const o=s.head||s.documentElement;null!==o&&o.appendChild(n)}}));
//# sourceMappingURL=adblocker.umd.min.js.map
